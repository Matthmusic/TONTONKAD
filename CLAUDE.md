# CLAUDE - Contexte du projet TontonKAD

## Vue d'ensemble
Application web PWA professionnelle pour la simulation et l'organisation de fourreaux √©lectriques en multitubulaires.
- Simulateur de multitubulaires avec algorithmes avanc√©s
- Calcul d'occupation des fourreaux rectangulaires et circulaires
- Visualisation 2D interactive haute r√©solution avec moteur physique
- Interface responsive avec panneau redimensionnable
- Syst√®me de projets avec sauvegarde/import/export
- Palette de couleurs AutoCAD int√©gr√©e

## Structure des fichiers (v√©rifi√©e le 2025-09-24)
```
TONTONKAD_DEV/
‚îú‚îÄ‚îÄ .claude/                          # Configuration Claude Code
‚îú‚îÄ‚îÄ .git/                             # D√©p√¥t Git
‚îú‚îÄ‚îÄ .gitignore                        # Exclusions Git
‚îú‚îÄ‚îÄ .vscode/                          # Configuration VS Code
‚îú‚îÄ‚îÄ app/                              # Application web principale
‚îÇ   ‚îú‚îÄ‚îÄ data/                         # Donn√©es CSV locales
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cables.csv                # Sp√©cifications c√¢bles (364 lignes, 8kb)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fourreaux.csv             # Sp√©cifications fourreaux (24 lignes, 1kb)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ chemins_de_cable.csv      # Chemins de c√¢bles (10 lignes, 1kb)
‚îÇ   ‚îú‚îÄ‚îÄ index.html                    # Interface principale (677 lignes)
‚îÇ   ‚îú‚îÄ‚îÄ style.css                     # Styles CSS (2594 lignes)
‚îÇ   ‚îú‚îÄ‚îÄ script.js                     # Logique principale (5192 lignes)
‚îÇ   ‚îú‚îÄ‚îÄ dimension-button-handler.js   # Gestion UI dimensionnement (300 lignes)
‚îÇ   ‚îú‚îÄ‚îÄ sw.js                         # Service Worker PWA (118 lignes)
‚îÇ   ‚îú‚îÄ‚îÄ manifest.json                 # Manifest PWA avec shortcuts
‚îÇ   ‚îú‚îÄ‚îÄ TONTONKAD.svg                 # Logo SVG (13.8kb)
‚îÇ   ‚îî‚îÄ‚îÄ ICONS_TODO.md                 # TODO list pour ic√¥nes
‚îú‚îÄ‚îÄ server.py                         # Serveur d√©veloppement Python avec CORS
‚îú‚îÄ‚îÄ TONTONKAD.bat                     # Script lancement Windows avec auto-install Python
‚îú‚îÄ‚îÄ README.md                         # Documentation utilisateur compl√®te
‚îî‚îÄ‚îÄ CLAUDE.md                         # Ce fichier (contexte pour Claude)
```

## Commandes de d√©veloppement
- **Lancement principal**: Double-clic sur `TONTONKAD.bat` (installation Python automatique)
- **Lancement d√©veloppeur**: `python server.py`
- **URL locale**: http://localhost:8000
- **Port par d√©faut**: 8000 (avec fallback si occup√©)
- **D√©veloppement**: Modifier directement les CSV dans `/app/data/` (pas de dossier /data/ s√©par√©)

## Technologies
- **Frontend**: HTML5 + CSS3 + JavaScript vanilla (aucune d√©pendance externe)
- **Canvas**: Rendu 2D haute r√©solution avec devicePixelRatio
- **PWA**: Progressive Web App compl√®te avec Service Worker
- **Moteur physique**: Gravit√© (0.25), friction (0.98), collisions (8 it√©rations)
- **Donn√©es**: Format CSV pour flexibilit√© configuration
- **Cache**: Service Worker avec strat√©gie Cache-First

## Fonctionnalit√©s principales

### üèóÔ∏è Simulation de multitubulaires
- Algorithme de grille adaptative avec arrangement r√©aliste
- Tri intelligent : gros fourreaux en bas, petits en haut
- Centrage automatique et espacement configurable (30mm)
- Placement depuis le bas selon logique multitubulaire

### üéÆ Interface interactive
- Canvas haute r√©solution avec zoom/pan
- Manipulation tactile et souris
- Modes : placement, s√©lection, suppression, √©dition
- Panneau redimensionnable avec splitter

### üíæ Gestion de projets
- Sauvegarde/chargement projets nomm√©s
- Auto-sauvegarde toutes les 30 secondes
- Import/export JSON pour partage
- LocalStorage pour persistance

### üìä Calculs avanc√©s
- Occupation fourreaux rectangulaires/circulaires
- Coefficient de foisonnement
- Simulation physique des c√¢bles
- Validation contraintes r√©glementaires

### üé® Syst√®me visuel
- Palette AutoCAD (256 couleurs)
- Rendu haute qualit√©
- Responsive design
- Th√®me professionnel

## Raccourcis clavier
- **Ctrl+G**: Arrangement grille multitubulaire
- **Ctrl+X**: Geler/d√©geler tous √©l√©ments
- **Ctrl+S**: Sauvegarder projet
- **Ctrl+C/V**: Copier/coller
- **Delete**: Supprimer s√©lection

## Algorithmes avanc√©s

### Grille multitubulaire
1. Calcul automatique dimensions optimales
2. Tri par diam√®tre d√©croissant (r√©alisme)
3. Placement depuis bas avec centrage horizontal
4. Espacement uniforme configurable
5. Fallback m√©thode classique si erreur

### Moteur physique
- Gravit√© : 0.25 (√©quilibre r√©alisme/performance)
- Friction : 0.98 pour amortissement naturel
- 8 it√©rations collision pour pr√©cision maximale
- Masse dynamique avec coefficient 0.02

## Performance et qualit√©

### M√©triques code
- **script.js**: 5192 lignes (c≈ìur application)
- **style.css**: 2594 lignes (interface compl√®te)
- **dimension-button-handler.js**: 300 lignes (gestion UI)
- **index.html**: 677 lignes (interface)
- **sw.js**: 118 lignes (service worker)
- **Total app**: ~8881 lignes JavaScript/CSS/HTML
- **Aucune d√©pendance externe** (autonomie compl√®te)

### Optimisations
- Canvas high-DPI avec devicePixelRatio
- Headers anti-cache pour d√©veloppement
- Preload ressources critiques
- Service Worker intelligent
- LocalStorage optimis√©

## Notes de d√©veloppement
- **Version courante**: v1.0.3 (interface am√©lior√©e et optimisations)
- **D√©veloppement actif**: Septembre 2025
- **Architecture**: Modulaire avec s√©paration concerns
- **Compatibilit√©**: Tous navigateurs modernes
- **Installation**: Zero-config avec TONTONKAD.bat
- **D√©bogage**: Console d√©veloppeur avec logs d√©taill√©s

## Bonnes pratiques de d√©veloppement

### Hi√©rarchie z-index (IMPORTANT)
Toujours respecter cette √©chelle pour √©viter les conflits d'affichage :
- **1-9** : √âl√©ments de base (cartes, panneaux, layouts)
- **10-99** : √âl√©ments sur√©lev√©s (boutons, contr√¥les, tooltips)
- **100-999** : Overlays et modales (notifications, dialogues)
- **1000-9999** : Dropdowns et menus contextuels (toujours visibles)

**Jamais de valeurs > 9999** - Utiliser cette hi√©rarchie logique pour maintenir l'ordre.

### Interface utilisateur
- **Dropdowns flottants** : Position absolute avec z-index 1000+
- **Recherche clavier** : Filtrage temps r√©el sur input
- **Coh√©rence visuelle** : M√™me style que les select natifs
- **Pas de d√©bordement** : box-sizing: border-box sur inputs

## Cas d'usage professionnels
- **√âlectriciens**: Calcul rapide occupation, optimisation installations
- **Bureaux d'√©tudes**: Dimensionnement infrastructures, plans techniques
- **Formation**: Apprentissage r√®gles, simulation interactive
- **Validation**: Configurations avant installation terrain